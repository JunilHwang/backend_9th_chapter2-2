# 상품 주문 서비스 요구사항 명세서

## 1. 프로젝트 개요

e-커머스 상품 주문 서비스를 구현하여 사용자가 상품을 주문하고 미리 충전한 잔액으로 결제할 수 있는 시스템을 제공합니다.

## 2. 공통 정책

### (1) 기능적 요구사항 정책

#### 1) 데이터 타입

- 사용자 ID, 상품 ID, 주문 ID, 쿠폰 ID: number
- 금액, 수량: number
- 날짜/시간: number(timestamp)

#### 2) 입력 유효성 검증

- 모든 필수 파라미터는 null이 아니어야 함
- 참조하는 모든 ID는 실제 존재하는 데이터여야 함
- 금액/수량: 0보다 커야 함
- 페이지 번호: 1 이상

#### 3) 상태 관리

- **주문 상태**: `PENDING`, `COMPLETED`, `FAILED`
- **결제 상태**: `SUCCESS`, `FAILED`
- **쿠폰 상태**: `AVAILABLE`, `USED`, `EXPIRED`

#### 4) 예외 처리

- **HTTP 상태**: 404 NOT_FOUND, 400 BAD_REQUEST, 500 INTERNAL_SERVER_ERROR
- **비즈니스 예외**: `INSUFFICIENT_BALANCE`, `OUT_OF_STOCK`, `COUPON_EXHAUSTED`

#### 5) 페이징

- 페이지 번호: 1부터 시작 (기본값: 1)
- 페이지 크기: 기본값 20개, 최대 100개


### (2) 비기능적 요구사항 정책

#### 1) 동시성 처리

- **락 정책**: 잔액(사용자별), 재고(상품별), 쿠폰(이벤트별)
- **트랜잭션**: 주문/결제는 하나의 트랜잭션, 재고/잔액 차감은 원자적 연산

#### 2) 성능 목표

- 조회 API: 100ms 이내
- 주문/결제 API: 500ms 이내
- 잔액 조회 API: 50ms 이내

#### 3) 캐싱

- 상품 정보: 5분 캐시
- 인기 상품 통계: 1시간 캐시
- 상품 변경 시 캐시 무효화

#### 4) 보안

- 모든 API 요청에 유효한 사용자 ID 필요
- 사용자는 본인의 데이터만 조회/수정 가능

## 3. 기능적 요구사항

### (1) 잔액 충전 / 조회

#### 1) 잔액 충전 기능

- **입력**: 사용자 ID, 충전 금액
- **출력**: 충전 후 총 잔액, 충전 상태, 충전 일시
- **예외케이스**:
  - 존재하지 않는 사용자 ID
  - 충전 금액이 0 이하
  - 일일 한도 초과 (1,000,000원)
  - 최대 보유 한도 초과 (10,000,000원)

#### 2) 잔액 조회 기능

- **입력**: 사용자 ID
- **출력**: 현재 잔액, 마지막 업데이트 일시
- **예외케이스**: 존재하지 않는 사용자 ID, 비활성화된 계정


### (2) 상품 조회

#### 1) 상품 정보 조회 기능

- **입력**: 상품 ID(개별 조회), 페이지 번호/크기(목록 조회)
- **출력**: 상품 ID, 이름, 가격, 잔여수량, 상태, 페이징 정보
- **예외케이스**: 존재하지 않는 상품 ID, 비활성화된 상품, 유효하지 않은 페이징 파라미터

### (3) 주문 / 결제

#### 2) 주문 처리 기능

- **입력**: 사용자 ID, 주문 상품 목록(상품 ID, 수량), 쿠폰 ID(선택)
- **출력**: 주문 ID, 주문 상태, 총 주문 금액, 할인 금액, 최종 결제 금액, 주문 일시
- **예외케이스**: 존재하지 않는 사용자/상품, 빈 주문 목록, 재고 부족, 잔액 부족, 유효하지 않은 쿠폰

#### 3) 결제 처리 기능

- **입력**: 주문 ID, 결제 금액
- **출력**: 결제 ID, 결제 상태, 결제 금액, 결제 후 잔액, 결제 일시
- **예외케이스**: 존재하지 않는 주문, 이미 결제된 주문, 금액 불일치, 잔액 부족, 시스템 오류

#### 4) 데이터 전송 기능

- **입력**: 주문 정보, 결제 정보
- **출력**: 전송 상태, 전송 일시
- **예외케이스**: 외부 플랫폼 연결 실패, 네트워크 오류, 데이터 형식 오류


### (4) 선착순 쿠폰

#### 1) 쿠폰 발급 기능
- **입력**: 사용자 ID, 쿠폰 이벤트 ID
- **출력**: 쿠폰 ID, 쿠폰 코드, 할인 금액/비율, 만료일, 발급 일시
- **예외케이스**: 존재하지 않는 사용자/이벤트, 쿠폰 소진, 중복 발급, 발급 기간 아님

#### 2) 쿠폰 조회 기능
- **입력**: 사용자 ID, 쿠폰 상태(선택)
- **출력**: 쿠폰 목록(ID, 코드, 할인 금액/비율, 상태, 만료일)
- **예외케이스**: 존재하지 않는 사용자, 보유 쿠폰 없음

#### 3) 쿠폰 적용 기능
- **입력**: 쿠폰 ID, 주문 금액
- **출력**: 할인 금액, 할인 적용 후 금액, 적용 상태
- **예외케이스**: 존재하지 않는 쿠폰, 이미 사용된 쿠폰, 만료된 쿠폰, 최소 사용 금액 미달


### (5) 인기 판매 상품 조회

#### 4) 상위 상품 조회 기능

- **입력**: 조회 일수(기본값: 3), 상위 상품 개수(기본값: 5)
- **출력**: 인기 상품 목록(상품 ID, 이름, 가격, 판매 수량, 매출액, 순위), 통계 기간, 전체 판매 건수
- **예외케이스**: 유효하지 않은 조회 일수(1-30), 상위 상품 개수(1-50), 통계 데이터 없음


## 4. 비기능적 요구사항

### (1) 확장성 및 가용성

- 다중 인스턴스 지원
- 분산 환경에서의 데이터 일관성 유지
- 로드 밸런싱 환경에서의 세션 관리

### (2) 처리량 요구사항

- 초당 1,000건 이상의 주문 처리 가능
- 동시 사용자 10,000명 지원

### (3) 데이터 무결성

- 결제 정보 암호화
- 민감한 개인정보 보호
- 트랜잭션 로그 관리

### (4) 모니터링 및 관찰성

- 주문 및 결제 과정의 상세 로그 기록
- 시스템 성능 지표 수집
- 재고 부족, 결제 실패 등 비즈니스 이벤트 모니터링

### (5) 데이터 관리

- 주문 및 결제 데이터의 정기적 백업
- 장애 발생 시 빠른 복구 방안
- 판매 통계 데이터 수집 및 분석

## 5. 테스트 요구사항

### (1) 단위 테스트

- 각 기능 및 제약사항에 대한 단위 테스트 작성
- 동시성 이슈 테스트
- 재고 관리 정확성 테스트
- 결제 프로세스 테스트

### (2) 통합 테스트

- API 간 연동 테스트
- 데이터베이스 트랜잭션 테스트
- 외부 시스템 연동 테스트

## 6. 구현 우선순위

### Phase 1 (기본 기능)

1. 잔액 충전/조회 API
2. 상품 조회 API
3. 기본 주문/결제 API

### Phase 2 (고급 기능)

1. 선착순 쿠폰 시스템
2. 인기 상품 조회 API
3. 실시간 데이터 전송

### Phase 3 (최적화)

1. 동시성 처리 개선
2. 성능 최적화
3. 모니터링 시스템 구축
